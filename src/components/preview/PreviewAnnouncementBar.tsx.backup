'use client';

import React, { useState, useEffect } from 'react';
import * as Icons from 'lucide-react';
import { PageType } from '@/types/editor.types';

interface PreviewAnnouncementBarProps {
  config: any;
  theme: any;
  pageType?: PageType;
  deviceView?: 'desktop' | 'mobile'; // Optional prop for editor preview
}

// Animation styles
const animationStyles = `
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  @keyframes slideInFromRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideInFromBottom {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  @keyframes typewriter {
    from {
      width: 0;
      opacity: 0;
    }
    to {
      width: 100%;
      opacity: 1;
    }
  }
  
  @keyframes marquee {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-33%);
    }
  }
  
  .animate-fadeIn {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  .animate-slideInFromRight {
    animation: slideInFromRight 0.5s ease-out;
  }
  
  .animate-slideInFromBottom {
    animation: slideInFromBottom 0.4s ease-out;
  }
  
  .animate-typewriter {
    animation: typewriter 0.8s steps(30, end);
    overflow: hidden;
    white-space: nowrap;
  }
`;

export default function PreviewAnnouncementBar({ config, theme, pageType, deviceView }: PreviewAnnouncementBarProps) {
  const [currentAnnouncementIndex, setCurrentAnnouncementIndex] = useState(0);
  const [isAnimating, setIsAnimating] = useState(false);
  const [animationKey, setAnimationKey] = useState(0);
  const [isMobile, setIsMobile] = useState(false);
  
  // Detect mobile viewport or use deviceView prop
  useEffect(() => {
    // If deviceView is provided (from editor), use it
    if (deviceView !== undefined) {
      setIsMobile(deviceView === 'mobile');
      return;
    }
    
    // Otherwise, detect actual viewport
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768);
    };
    
    checkMobile();
    window.addEventListener('resize', checkMobile);
    
    return () => window.removeEventListener('resize', checkMobile);
  }, [deviceView]);
  
  // Debug log to verify config
  console.log('PreviewAnnouncementBar config:', config);
  console.log('Announcements:', config?.announcements);
  console.log('Current index:', currentAnnouncementIndex);
  console.log('Animation style:', config?.animationStyle);
  console.log('Page type:', pageType);
  console.log('Show only on home page:', config?.showOnlyHomePage);
  
  // Check if should show on this page
  if (config?.showOnlyHomePage && pageType !== PageType.HOME) {
    console.log('Not showing announcement bar - only enabled for home page');
    return null;
  }
  
  // Validate configuration
  if (!config?.enabled || !config?.announcements || config.announcements.length === 0) {
    return null;
  }

  // Extract color scheme
  const colorScheme = theme?.colorSchemes?.schemes?.[parseInt(config.colorScheme || '1') - 1];
  const borderRadius = `${config.edgeRounding || 0}px`;
  
  // Get announcements
  const announcements = config.announcements || [];
  const currentAnnouncement = announcements[currentAnnouncementIndex];

  // Auto-play functionality
  useEffect(() => {
    // Skip interval for infinite marquee - it uses CSS animation
    if (config?.animationStyle === 'infinite-marquee') {
      setCurrentAnnouncementIndex(0);
      return;
    }
    
    if (config.autoplay?.mode === 'one-at-a-time' && 
        announcements.length > 1 && 
        config?.animationStyle !== 'infinite-marquee') {
      const interval = setInterval(() => {
        setIsAnimating(true);
        setTimeout(() => {
          setCurrentAnnouncementIndex((prev) => (prev + 1) % announcements.length);
          setIsAnimating(false);
        }, 300);
      }, (config.autoplay.speed || 5) * 1000);

      return () => clearInterval(interval);
    }
    
    // Reset index when no autoplay
    if (config?.autoplay?.mode === 'none') {
      setCurrentAnnouncementIndex(0);
    }
  }, [
    config?.autoplay?.mode,
    config?.autoplay?.speed,
    config?.animationStyle,
    announcements.length
  ]);
  
  // Force re-render when animation style changes
  useEffect(() => {
    setAnimationKey(prev => prev + 1);
  }, [config?.animationStyle]);

  const handlePrevious = () => {
    setCurrentAnnouncementIndex((prev) => 
      prev === 0 ? announcements.length - 1 : prev - 1
    );
  }

  const handleNext = () => {
    setCurrentAnnouncementIndex((prev) => 
      (prev + 1) % announcements.length
    );
  };

  // Social media icons with actual SVGs
  const socialIcons: { [key: string]: JSX.Element } = {
    instagram: (
      <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1 1 12.324 0 6.162 6.162 0 0 1-12.324 0zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm4.965-10.405a1.44 1.44 0 1 1 2.881.001 1.44 1.44 0 0 1-2.881-.001z"/>
      </svg>
    ),
    facebook: (
      <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
    ),
    twitter: (
      <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
      </svg>
    ),
    youtube: (
      <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
      </svg>
    ),
    pinterest: (
      <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 0C5.373 0 0 5.372 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738a.36.36 0 01.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"/>
      </svg>
    ),
    tiktok: (
      <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
      </svg>
    ),
    linkedin: (
      <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
      </svg>
    ),
    whatsapp: (
      <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.149-.67.149-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414-.074-.123-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
      </svg>
    )
  };

  // Outline versions of social media icons
  const socialIconsOutline: { [key: string]: JSX.Element } = {
    instagram: (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
      </svg>
    ),
    facebook: (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
      </svg>
    ),
    twitter: (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
      </svg>
    ),
    youtube: (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path>
        <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
      </svg>
    ),
    pinterest: (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M8 11.5c0-2.5 2-4.5 4.5-4.5s4.5 2 4.5 4.5c0 2.12-1.5 3.9-3.5 4.36-.25-.5-.5-1.29-.5-1.86 0 0 1-4 1-4a2 2 0 0 0-2-2c-1.1 0-2 .9-2 2 0 .67.25 1.25.25 1.25s-1 4.25-1.17 5c-.35 1.5 0 3.33.03 3.5"></path>
      </svg>
    ),
    tiktok: (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <path d="M9 12a4 4 0 1 0 4-4v8.5a2.5 2.5 0 1 1-2.5-2.5"></path>
        <path d="M13 8V3.5A3.5 3.5 0 0 0 16.5 7a6.5 6.5 0 0 0 4 1.5"></path>
      </svg>
    ),
    linkedin: (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
        <rect x="2" y="9" width="4" height="12"></rect>
        <circle cx="4" cy="4" r="2"></circle>
      </svg>
    ),
    whatsapp: (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
      </svg>
    )
  };

  const renderSocialIcon = (platform: string, style: string = 'solid') => {
    // Normalize platform name to lowercase for matching
    const normalizedPlatform = platform.toLowerCase();
    const icons = style === 'outline' ? socialIconsOutline : socialIcons;
    return icons[normalizedPlatform] || icons[platform] || (
      <div className="w-4 h-4 rounded-full bg-current opacity-60"></div>
    );
  }

  // Get animation class based on selected style
  const getAnnouncementAnimationClass = (animationStyle: string | undefined) => {
    if (!animationStyle || animationStyle === 'no-animation') return '';
    
    switch (animationStyle) {
      case 'fade':
        return 'animate-fadeIn';
      case 'slide-horizontal':
        return 'animate-slideInFromRight';
      case 'slide-vertical':
        return 'animate-slideInFromBottom';
      case 'typewriter':
        return 'animate-typewriter';
      case 'infinite-marquee':
        return ''; // Marquee has its own special structure
      default:
        return '';
    }
  }
  
  // Render announcement icon
  const renderAnnouncementIcon = (iconValue: string) => {
    const iconMap: { [key: string]: any } = {
      // General
      'Settings': Icons.Settings,
      'Search': Icons.Search,
      'Eye': Icons.Eye,
      'EyeOff': Icons.EyeOff,
      'User': Icons.User,
      'HeartOutline': Icons.Heart,
      'HeartSolid': Icons.Heart,
      'ThumbsUp': Icons.ThumbsUp,
      'ThumbsDown': Icons.ThumbsDown,
      'Lightbulb': Icons.Lightbulb,
      'StarOutline': Icons.Star,
      'StarSolid': Icons.Star,
      'Trash2': Icons.Trash2,
      'FileText': Icons.FileText,
      'Copy': Icons.Copy,
      'Share2': Icons.Share2,
      'Plus': Icons.Plus,
      'Minus': Icons.Minus,
      'Check': Icons.Check,
      'ArrowRight': Icons.ArrowRight,
      'ArrowLeft': Icons.ArrowLeft,
      'Undo': Icons.Undo,
      'Redo': Icons.Redo,
      'RefreshCw': Icons.RefreshCw,
      'Bell': Icons.Bell,
      'Clock': Icons.Clock,
      'Calendar': Icons.Calendar,
      'Info': Icons.Info,
      // Shop
      'ShoppingBag': Icons.ShoppingBag,
      'ShoppingCart': Icons.ShoppingCart,
      'Barcode': Icons.Barcode,
      'Coupon': Icons.Tag,
      'Gift': Icons.Gift,
      'TrendingDown': Icons.TrendingDown,
      'Percent': Icons.Percent,
      'Award': Icons.Award,
      'Pen': Icons.Pen,
      'Palette': Icons.Palette,
      'Car': Icons.Truck,
      'Coffee': Icons.Coffee,
      'Cake': Icons.Coffee,
      'Anchor': Icons.Anchor,
      'TShirt': Icons.Shirt,
      'Dress': Icons.Shirt,
      'Gem': Icons.Circle,
      'Home': Icons.Home,
      'Play': Icons.Play,
      // Shipping
      'Package': Icons.Package,
      'MapPin': Icons.MapPin,
      'FastDelivery': Icons.Truck,
      'DeliveryTruck': Icons.Truck,
      'RotateCcw': Icons.RotateCcw,
      'Globe': Icons.Globe,
      'Plane': Icons.Send,
      'SearchOrder': Icons.Search,
      'Briefcase': Icons.Briefcase,
      'Archive': Icons.Archive,
      'Navigation': Icons.Navigation,
      // Payment security
      'CreditCard': Icons.CreditCard,
      'Lock': Icons.Lock,
      'Shield': Icons.Shield,
      'SecurePayment': Icons.Lock,
      'Wallet': Icons.CreditCard,
      'DollarSign': Icons.DollarSign,
      'Receipt': Icons.FileText,
      'Tag': Icons.Tag,
      'List': Icons.List,
      'Scan': Icons.Maximize,
      // Communication
      'Phone': Icons.Phone,
      'MessageCircle': Icons.MessageCircle,
      'MessageSquare': Icons.MessageSquare,
      'Mail': Icons.Mail,
      'HelpCircle': Icons.HelpCircle,
      'Printer': Icons.Printer,
      'Smartphone': Icons.Smartphone,
      // Ecology
      'Bug': Icons.Bug,
      'Mask': Icons.Shield,
      'Leaf': Icons.Feather,
      'GitBranch': Icons.GitBranch,
      // Social
      'Twitter': Icons.Twitter,
      'Facebook': Icons.Facebook,
      'Pinterest': Icons.Share2,
      'Instagram': Icons.Instagram,
      'TikTok': Icons.Music,
      'Tumblr': Icons.Circle,
      'Snapchat': Icons.Camera,
      'Youtube': Icons.Youtube,
      'Vimeo': Icons.Video,
      'Linkedin': Icons.Linkedin,
      'Flickr': Icons.Image,
      'Reddit': Icons.Hash,
      'EmailSocial': Icons.Mail,
      'Behance': Icons.Circle,
      'Discord': Icons.MessageCircle,
      'Dribbble': Icons.Dribbble,
      'Medium': Icons.Edit3,
      'Twitch': Icons.Twitch,
      'WhatsApp': Icons.MessageSquare,
      'Viber': Icons.Headphones,
      'Telegram': Icons.Send
    };

    const IconComponent = iconMap[iconValue];
    if (IconComponent) {
      return <IconComponent className="w-5 h-5" />;
    }
    return null;
  }
  
  // Determine max width based on width setting
  const getMaxWidth = () => {
    switch(config?.width) {
      case 'screen': return '100%';
      case 'page': return '100%';
      case 'large': return '1400px';
      case 'medium': return '1200px';
      default: return '100%';
    }
  }

  // Check if should show based on page type
  if (config?.showOnlyHomePage && pageType !== PageType.HOME) {
    return null;
  }

  // Check if enabled and has announcements
  if (!config?.enabled || announcements.length === 0) {
    return null;
  }

  // Main return of the component
  return (
    <>
      {/* Inject animation styles */}
      <style dangerouslySetInnerHTML={{ __html: animationStyles }} />
      <div 
        style={{ 
          backgroundColor: colorScheme?.background || '#000000',
          color: colorScheme?.text || '#ffffff',
          borderRadius: config.width !== 'screen' ? borderRadius : '0',
          maxWidth: getMaxWidth(),
          margin: config.width !== 'screen' ? '0 auto' : '0'
        }}
        className="relative"
    >
      <div className={`flex items-center justify-between py-2 ${isMobile ? 'px-2' : 'px-4'}`}>
        {/* Left side - Social media icons (only desktop) */}
        {!isMobile ? (
          <div className="flex items-center gap-3">
            {config.socialMediaIcons?.enabled && config.socialMediaIcons?.showOnDesktop && (
              <div className="flex items-center gap-3">
              {Object.entries(config.socialMediaUrls || {})
                .filter(([_, url]) => url)
                .slice(0, 5) // Show max 5 icons
                .map(([platform, url]) => (
                  <a 
                    key={platform} 
                    href={url as string} 
                    className="hover:opacity-70 transition-opacity"
                    target="_blank"
                    rel="noopener noreferrer"
                    aria-label={platform}
                  >
                    {renderSocialIcon(platform, config.socialMediaIcons?.iconStyle || 'solid')}
                  </a>
                ))}
              </div>
            )}
          </div>
        ) : (
          <div></div> {/* Empty div for mobile - matching EditorPreview.tsx */}
        )}

        {/* Center - Announcement text with navigation arrows */}
        <div className={`flex-1 flex items-center justify-center ${isMobile ? 'gap-4' : 'gap-36'}`}>
          {/* Left Arrow */}
          {config.showNavigationArrows && announcements.length > 1 && (
            <button 
              onClick={handlePrevious}
              className={`${isMobile ? 'p-0.5' : 'p-1'} hover:opacity-70 transition-opacity`}
              aria-label="Previous announcement"
            >
              <svg className={`${isMobile ? 'w-3 h-3' : 'w-4 h-4'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
              </svg>
            </button>
          )}

          {/* Announcement Text with Animation */}
          {config?.animationStyle === 'infinite-marquee' && announcements.length > 0 ? (
            // Marquee animation - special structure
            <div className={`${isMobile ? 'text-xs' : 'text-sm'} overflow-hidden whitespace-nowrap`} style={{ minHeight: '24px', width: '100%' }}>
              <div 
                className="inline-flex"
                style={{
                  animation: 'marquee 8s linear infinite'
                }}
              >
                {/* Create 2 copies for seamless loop */}
                {[...Array(2)].map((_, copyIndex) => (
                  announcements.map((announcement: any, idx: number) => (
                    <div key={`${copyIndex}-${idx}`} className="inline-flex items-center gap-2 mx-2">
                      {announcement?.icon && renderAnnouncementIcon(announcement.icon)}
                      {announcement?.link ? (
                        <a href={announcement.link} className="hover:underline" style={{ color: 'inherit' }}>
                          {announcement.text || 'Welcome to our store!'}
                        </a>
                      ) : (
                        <span>{announcement.text || 'Welcome to our store!'}</span>
                      )}
                    </div>
                  ))
                ))}
              </div>
            </div>
          ) : (
            // Other animations - regular structure
            <div className={`text-center ${isMobile ? 'text-xs' : 'text-sm'} flex items-center gap-2 relative overflow-hidden`} style={{ minHeight: '24px' }}>
              <div 
                className={`flex items-center gap-2 ${getAnnouncementAnimationClass(config?.animationStyle)}`}
                key={`announcement-${currentAnnouncementIndex}-${animationKey}`}
              >
                {currentAnnouncement?.icon && renderAnnouncementIcon(currentAnnouncement.icon)}
                {currentAnnouncement?.link ? (
                  <a 
                    href={currentAnnouncement.link} 
                    className="hover:underline"
                    style={{ color: 'inherit' }}
                  >
                    {currentAnnouncement.text || 'Welcome to our store!'}
                  </a>
                ) : (
                  <span>{currentAnnouncement?.text || 'Welcome to our store!'}</span>
                )}
              </div>
            </div>
          )}

          {/* Right Arrow */}
          {config.showNavigationArrows && announcements.length > 1 && (
            <button 
              onClick={handleNext}
              className={`${isMobile ? 'p-0.5' : 'p-1'} hover:opacity-70 transition-opacity`}
              aria-label="Next announcement"
            >
              <svg className={`${isMobile ? 'w-3 h-3' : 'w-4 h-4'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
              </svg>
            </button>
          )}
        </div>

        {/* Right side - Language/Currency selectors (only desktop) */}
        {!isMobile && (
          <div className="flex items-center gap-8">
          {config.languageSelector?.enabled && config.languageSelector?.showOnDesktop && (
            <div className="relative">
              <select 
                className="bg-transparent text-xs border-0 outline-none cursor-pointer appearance-none pr-4"
                style={{ color: 'inherit' }}
                defaultValue="ES"
              >
                <option value="ES">Español</option>
                <option value="EN">English</option>
                <option value="FR">Français</option>
                <option value="DE">Deutsch</option>
              </select>
              <svg className="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          )}
          {config.currencySelector?.enabled && config.currencySelector?.showOnDesktop && (
            <div className="relative">
              <select 
                className="bg-transparent text-xs border-0 outline-none cursor-pointer appearance-none pr-4"
                style={{ color: 'inherit' }}
                defaultValue="USD"
              >
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
                <option value="GBP">GBP</option>
                <option value="CAD">CAD</option>
              </select>
              <svg className="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          )}
          </div>
        )}
      </div>
    </div>
    </>
  );
}